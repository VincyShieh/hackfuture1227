<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>è‰è‰çš„æœºå™¨äºº</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      user-select: none;
    }
    body {
      font-family: "Helvetica Neue", Arial, sans-serif;
      background: #f0f8ff;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      overflow: hidden;
      touch-action: none;
    }
    #game-container {
      width: 100%;
      max-width: 600px;
      text-align: center;
      position: relative;
    }

    /* å¯åŠ¨ç•Œé¢ */
    #start-screen {
      padding: 30px;
      background: white;
      border-radius: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    #start-screen h1 {
      color: #e91e63;
      margin-bottom: 20px;
      font-size: 1.8em;
    }
    .parent-note {
      font-size: 14px;
      color: #555;
      line-height: 1.5;
      margin: 20px 0;
      padding: 12px;
      background: #f9f9f9;
      border-left: 4px solid #4caf50;
      text-align: left;
    }
    .skin-selector {
      margin: 20px 0;
    }
    .skin-option {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: inline-block;
      margin: 0 8px;
      cursor: pointer;
      border: 2px solid transparent;
    }
    .skin-option.selected {
      border-color: #2196f3;
      transform: scale(1.1);
    }
    #skin1 { background: #f9d9b7; } /* æµ… */
    #skin2 { background: #c19a6b; } /* ä¸­ */
    #skin3 { background: #7a5230; } /* æ·± */

    button#start-btn {
      background: #2196f3;
      color: white;
      border: none;
      padding: 12px 30px;
      font-size: 18px;
      border-radius: 30px;
      cursor: pointer;
      margin-top: 15px;
      transition: background 0.2s;
    }
    button#start-btn:hover {
      background: #0d8aee;
    }

    /* æ¸¸æˆä¸»ç•Œé¢ */
    #game-screen {
      display: none;
      padding: 20px;
    }
    #lily {
      font-size: 60px;
      margin-bottom: 20px;
      line-height: 1;
    }
    #robot {
      width: 200px;
      height: 200px;
      background: #bbb;
      border-radius: 20px;
      margin: 0 auto 30px;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      color: white;
      font-weight: bold;
      background: linear-gradient(135deg, #6a6a6a, #333);
    }
    .slot {
      width: 50px;
      height: 50px;
      border: 2px dashed #fff;
      border-radius: 8px;
      margin: 8px;
      display: flex;
      justify-content: center;
      align-items: center;
      background: rgba(255,255,255,0.1);
    }
    #toolbox {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    .part {
      width: 60px;
      height: 60px;
      border-radius: 12px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 28px;
      cursor: grab;
      background: white;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      transition: transform 0.1s;
      /* å…³é”®ï¼šå…è®¸ç»å¯¹å®šä½ */
      position: relative;
    }

    /* è·³èˆåŠ¨ç”» */
    @keyframes dance {
      0%, 100% { transform: rotate(0deg) translateY(0); }
      25% { transform: rotate(-10deg) translateY(-10px); }
      50% { transform: rotate(0deg) translateY(0); }
      75% { transform: rotate(10deg) translateY(-10px); }
    }
    .dancing {
      animation: dance 0.8s infinite ease-in-out;
    }

    #restart-btn {
      margin-top: 20px;
      padding: 10px 20px;
      background: #4caf50;
      color: white;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      display: none;
    }
  </style>
</head>
<body>
  <div id="game-container">
    <!-- å¯åŠ¨ç•Œé¢ -->
    <div id="start-screen">
      <h1>è‰è‰çš„æœºå™¨äºº</h1>
      <div class="parent-note">
        æœ¬æ¸¸æˆæ—¨åœ¨é¼“åŠ±å­©å­åƒå·¥ç¨‹å¸ˆä¸€æ ·æ€è€ƒâ€”â€”è§‚å¯Ÿã€å°è¯•ã€ä¸æ€•å¤±è´¥ã€‚
      </div>

      <div>é€‰æ‹©è‰è‰çš„è‚¤è‰²ï¼š</div>
      <div class="skin-selector">
        <div class="skin-option selected" id="skin1" data-skin="#f9d9b7"></div>
        <div class="skin-option" id="skin2" data-skin="#c19a6b"></div>
        <div class="skin-option" id="skin3" data-skin="#7a5230"></div>
      </div>

      <button id="start-btn">å¼€å§‹æ¸¸æˆ</button>
    </div>

    <!-- æ¸¸æˆä¸»ç•Œé¢ -->
    <div id="game-screen">
      <div id="lily">ğŸ‘§</div>
      <div id="robot">
        <div class="slot" id="slot1" data-part="gear">?</div>
        <div class="slot" id="slot2" data-part="battery">?</div>
        <div class="slot" id="slot3" data-part="wheel">?</div>
      </div>
      <div id="toolbox">
        <div class="part" data-type="gear">âš™ï¸</div>
        <div class="part" data-type="battery">ğŸ”‹</div>
        <div class="part" data-type="wheel">ğŸ›</div>
      </div>
      <button id="restart-btn">å†ç©ä¸€æ¬¡</button>
    </div>
  </div>

  <script>
    let currentSkin = '#f9d9b7';
    let placedParts = new Set();
    const correctMap = {
      slot1: 'gear',
      slot2: 'battery',
      slot3: 'wheel'
    };
    const praisePhrases = [
      'ä½ çœŸç»†å¿ƒï¼',
      'è¿™ä¸ªä¸»æ„å¤ªæ£’äº†ï¼',
      'å·¥ç¨‹å¸ˆå°±æ˜¯è¿™ä¹ˆè§£å†³é—®é¢˜çš„ï¼',
      'æˆ‘å°±çŸ¥é“ä½ èƒ½è¡Œï¼'
    ];

    // çš®è‚¤é€‰æ‹©
    document.querySelectorAll('.skin-option').forEach(el => {
      el.addEventListener('click', () => {
        document.querySelectorAll('.skin-option').forEach(e => e.classList.remove('selected'));
        el.classList.add('selected');
        currentSkin = el.dataset.skin;
      });
    });

    // å¼€å§‹æ¸¸æˆ
    document.getElementById('start-btn').addEventListener('click', () => {
      document.getElementById('lily').style.color = currentSkin;
      document.getElementById('start-screen').style.display = 'none';
      document.getElementById('game-screen').style.display = 'block';
    });

    // é‡å¯
    document.getElementById('restart-btn').addEventListener('click', () => {
      placedParts.clear();
      document.querySelectorAll('.slot').forEach(slot => {
        slot.textContent = '?';
        slot.classList.remove('dancing');
      });
      document.getElementById('restart-btn').style.display = 'none';
      document.querySelectorAll('.part').forEach(p => {
        p.style.display = 'flex';
        p.style.position = 'static';
        p.style.zIndex = '';
        p.style.transform = '';
      });
    });

    // ===== ç»Ÿä¸€æ‹–æ‹½é€»è¾‘ï¼ˆPointer + Mouseï¼‰=====
    let draggedElement = null;
    let offsetX = 0, offsetY = 0;

    document.querySelectorAll('.part').forEach(part => {
      part.addEventListener('pointerdown', (e) => {
        // åªå“åº”å·¦é”®æˆ–è§¦å±
        if (e.button !== undefined && e.button !== 0) return;
        
        draggedElement = part;
        const rect = part.getBoundingClientRect();
        offsetX = e.clientX - rect.left;
        offsetY = e.clientY - rect.top;

        // æå‡å±‚çº§å¹¶è®¾ç½®ä¸º fixed
        part.style.position = 'fixed';
        part.style.zIndex = '1000';
        part.style.cursor = 'grabbing';
        part.style.transform = 'scale(1.1)';

        // é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼ˆå¦‚é•¿æŒ‰èœå•ï¼‰
        e.preventDefault();
      });
    });

    window.addEventListener('pointermove', (e) => {
      if (!draggedElement) return;
      const x = e.clientX - offsetX;
      const y = e.clientY - offsetY;
      draggedElement.style.left = x + 'px';
      draggedElement.style.top = y + 'px';
    });

    window.addEventListener('pointerup', (e) => {
      if (!draggedElement) return;

      const partType = draggedElement.dataset.type;
      let droppedInSlot = false;

      // æ£€æŸ¥æ˜¯å¦è½åœ¨æŸä¸ªæ§½å†…
      document.querySelectorAll('.slot').forEach(slot => {
        if (droppedInSlot) return;
        const slotRect = slot.getBoundingClientRect();
        const centerX = parseFloat(draggedElement.style.left) + draggedElement.offsetWidth / 2;
        const centerY = parseFloat(draggedElement.style.top) + draggedElement.offsetHeight / 2;

        if (
          centerX >= slotRect.left &&
          centerX <= slotRect.right &&
          centerY >= slotRect.top &&
          centerY <= slotRect.bottom
        ) {
          handleDrop(partType, slot);
          droppedInSlot = true;
        }
      });

      // é‡ç½®æ‹–æ‹½å…ƒç´ æ ·å¼
      draggedElement.style.position = 'static';
      draggedElement.style.zIndex = '';
      draggedElement.style.left = '';
      draggedElement.style.top = '';
      draggedElement.style.transform = '';
      draggedElement.style.cursor = 'grab';

      draggedElement = null;
    });

    function handleDrop(partType, slot) {
      const expected = slot.dataset.part;
      const slotId = slot.id;
      if (partType === expected && !placedParts.has(slotId)) {
        placedParts.add(slotId);
        slot.textContent = getEmojiFor(partType);
        speak(praisePhrases[Math.floor(Math.random() * praisePhrases.length)]);

        // éšè—é›¶ä»¶
        document.querySelector(`.part[data-type="${partType}"]`).style.display = 'none';

        if (placedParts.size === 3) {
          celebrate();
        }
      }
    }

    function getEmojiFor(type) {
      return { gear: 'âš™ï¸', battery: 'ğŸ”‹', wheel: 'ğŸ›' }[type] || '?';
    }

    function speak(text) {
      if ('speechSynthesis' in window) {
        speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'zh-CN';
        utterance.rate = 1.0;
        utterance.pitch = 1.1;
        speechSynthesis.speak(utterance);
      }
    }

    function celebrate() {
      document.getElementById('robot').classList.add('dancing');
      setTimeout(() => {
        speak('ä¸‹æ¬¡æˆ‘è¦é€ ä¸€æ¶é£å‘æœˆäº®çš„è½¦ï¼');
      }, 800);
      document.getElementById('restart-btn').style.display = 'inline-block';
    }
  </script>
</body>
</html>